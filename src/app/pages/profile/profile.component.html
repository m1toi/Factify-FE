<!-- PROFILE LAYOUT -->
<div class="profile-layout flex h-screen bg-black">
  <!-- Sidebar -->
  <div class="sidebar-col w-14 flex-shrink-0">
    <app-sidebar></app-sidebar>
  </div>

  <!-- CONTENT -->
  <div class="profile-content flex-1 p-8 text-white overflow-auto">
    <ng-container *ngIf="user as u; else loading">
      <div class="profile-header flex items-center gap-6 mb-8">
        <!-- Avatar -->
        <img
          class="w-32 h-32 rounded-full object-cover"
          [src]="
            u.profilePicture
              ? '/assets/avatars/' + u.profilePicture
              : defaultAvatar
          "
          alt="Avatar"
        />
        <!-- Name + Edit button -->
        <div class="profile-info flex flex-col gap-2">
          <h2 class="text-4xl font-semibold">{{ u.name }}</h2>
          <button
            *ngIf="isOwnProfile"
            pButton
            type="button"
            class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-white font-medium text-sm w-fit"
            (click)="openEdit()"
          >
            Edit profile
          </button>
        </div>
      </div>

      <!-- placeholder for posts -->
      <div class="text-center py-10 border-t border-gray-700">
        <p class="text-gray-400">User’s posts will appear here.</p>
      </div>
    </ng-container>

    <ng-template #loading>
      <div class="text-white p-8">Loading profile…</div>
    </ng-template>
  </div>
</div>

<!-- EDIT PROFILE DIALOG – only render once `user` is defined -->
<p-dialog
  *ngIf="user"
  [(visible)]="showEditDialog"
  [modal]="true"
  [closable]="false"
  [draggable]="false"
  [style]="{ width: '450px' }"
  styleClass="!bg-zinc-900 !rounded-lg !shadow-xl !border-none !p-0"
  (onHide)="closeEdit()"
>
  <!-- HEADER -->
  <ng-template pTemplate="header">
    <div
      class="flex items-center justify-between w-full pt-4 px-1 pb-3 border-b border-zinc-700 bg-zinc-900"
    >
      <h2 class="text-xl font-semibold text-white">Edit profile</h2>
      <button
        pButton
        type="button"
        icon="pi pi-times"
        class="p-button-rounded p-button-text p-button-plain !text-white  !bg-transparent
    "
        (click)="closeEdit()"
      ></button>
    </div>
  </ng-template>

  <!-- CONTENT -->
  <div class="text-white p-6 bg-zinc-900 space-y-6">
    <!-- Profile photo chooser -->
    <div class="flex flex-col w-full">
      <span class="text-sm font-medium text-gray-300 mb-2">Profile photo</span>

      <!-- SCROLLABLE AVATAR ROW -->
      <div
        class="overflow-x-auto snap-x snap-mandatory avatar-scroll mt-4"
        style="scroll-padding: 0 1rem;"
      >
        <div class="flex space-x-4 px-4 pb-3">
          <ng-container *ngFor="let av of avatarOptions">
            <img
              [src]="'/assets/avatars/' + av"
              (click)="selectAvatar(av)"
              class="w-24 h-24 flex-shrink-0 rounded-full object-cover
                     cursor-pointer border-4 border-transparent
                     hover:border-blue-500 transition snap-center"
              [class.border-blue-400]="editableUser.profilePicture === av"
              alt="avatar option"
            />
          </ng-container>
        </div>
      </div>
    </div>

    <!-- Username input -->
    <div class="flex flex-col gap-2">
      <span class="text-sm font-medium text-gray-300">Username</span>
      <input
        id="username"
        type="text"
        pInputText
        [(ngModel)]="editableUser.name"
        class="!bg-zinc-800 !border !border-zinc-900 !text-white !rounded-md px-3 py-2
         focus:outline-none focus:ring-2 focus:ring-blue-500 !placeholder-white"
        placeholder="Enter your username"
      />
      <p class="text-xs text-gray-400 mt-1">
        Usernames can only contain letters, numbers, underscores, and periods.
      </p>
    </div>
  </div>

  <!-- FOOTER -->
  <ng-template pTemplate="footer">
    <div
      class="flex items-center justify-between w-full bg-zinc-900 px-1 pt-3 pb-4 !border-t border-zinc-700"
    >
      <button
        pButton
        type="button"
        class="px-4 py-2 !bg-zinc-700 hover:bg-zinc-600 text-white rounded font-medium text-sm"
        (click)="closeEdit()"
      >
        Cancel
      </button>
      <button
        pButton
        type="button"
        class="px-4 py-2 !bg-red-600 hover:bg-red-700 text-white rounded font-medium text-sm"
        (click)="saveProfile()"
      >
        Save
      </button>
    </div>
  </ng-template>

</p-dialog>
